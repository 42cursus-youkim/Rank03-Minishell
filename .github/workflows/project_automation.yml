name: Project automations
on:
  issues:
    types: [opened, reopened, closed, assigned]

  pull_request:
    types: [opened, reopened, review_requested, closed]

env:
  triage: 🗃️ Triage
  todo: 💡 Todo
  in_progress: 🚧 In Progress
  done: ✅ Done
  
  event_name: ${{ github.event_name }}
  event_action: ${{ github.event.action }}

jobs:
  which:
    runs-on: ubuntu-latest
    outputs:
      to: ${{ steps.figure.outputs.result }}
    steps:
      - id: figure
        run: |
          case $event_name in
            issues)
              case $event_action in
                opened | reopened | review_requested | unassigned) 
                  TO="$triage";;
                assigned)
                  TO="$todo";;
                closed)
                  TO="$done";;                
              esac
            ;;
            pull_request)
              case $event_action in
                opened | reopened | review_requested)
                  TO="$in_progress";;
                closed)
                  TO="$done";;
              esac
            ;;
          esac
          echo "result: $TO"
          echo "::set-output name=result::$TO"
  
  move_card:
    runs-on: ubuntu-latest
    needs: which
    steps:  
      - name: Move issue to ${{ needs.which.outputs.to }}
        uses: leonsteinhaeuser/project-beta-automations@v1.1.1
        with:
          gh_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          organization: minishell-jiphyeonjeon
          project_id: 1
          resource_node_id: ${{ github.event.issue.node_id }}
          status_value: ${{ needs.which.outputs.to }} # Target status          
